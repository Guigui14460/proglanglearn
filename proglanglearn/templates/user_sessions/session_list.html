{% extends "base.html" %}
{% load user_sessions i18n %}

{% block title %}{% trans "Mes sessions" %} - {% endblock title %}

{% block main %}
{% trans "<em>unknown on unknown</em>" as unknown_on_unknown %}
{% trans "<em>unknown</em>" as unknown %}

<h1>{% trans "Sessions actives" %}</h1>

<div class="table table__success mb-1">
    <table>
        <tr>
            <th>{% trans "Lieu" %}</th>
            <th>{% trans "Appareil" %}</th>
            <th>{% trans "Dernière activité" %}</th>
            <th>{% trans "Fin de session" %}</th>
        </tr>
        {% for object in object_list %}
            <tr {% if object.session_key == session_key %}class="active"{% endif %}>
                <td>{{ object.ip|location|default_if_none:unknown|safe }} <small>({{ object.ip }})</small></td>
                <td>{{ object.user_agent|device|default_if_none:unknown_on_unknown|safe }}</td>
                <td>
                    {% if object.session_key == session_key %}
                        {% blocktrans with time=object.last_activity|timesince %}Il y a {{ time }} (cette session){% endblocktrans %}
                    {% else %}
                        {% blocktrans with time=object.last_activity|timesince %}Il y a {{ time }}{% endblocktrans %}
                    {% endif %}
                </td>
                <td>
                    <form method="post" action="{% url 'accounts:session_delete' pk=object.pk %}">
                        {% csrf_token %}
                        {% if object.session_key == session_key %}
                            <button type="submit" class="btn btn__danger">{% trans "Fermer la session" %}</button>
                        {% else %}
                            <button type="submit" class="btn btn__warning">{% trans "Fermer la session" %}</button>
                        {% endif %}
                    </form>
                </td>
            </tr>
        {% endfor %}
    </table>
</div>
{% if object_list.count > 1 %}
    <form method="post" action="{% url 'accounts:session_delete_other' %}">
        {% csrf_token %}
        <div  class="note note__info">
            <p>{% blocktrans %}Vous pouvez aussi fermer toutes les sessions en une seule fois mais pas celle sur laquelle vous vous trouvez. Cela vous déconnectera de tous les autres appareils où votre connexion est active{% endblocktrans %}</p>
        </div>
        <button type="submit" class="btn btn__large btn__block btn__warning">{% trans "End All Other Sessions" %}</button>
    </form>
{% endif %}
{% endblock main %}