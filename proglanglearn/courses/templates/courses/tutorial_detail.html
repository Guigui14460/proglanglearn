{% extends 'base.html' %}
{% load static %}

{% block title %}{{ object.title }} - {% endblock title %}

{% block extra_head %}
<link rel="stylesheet" href="{% static '/style/css/vs2015.css' %}">
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
{% endblock extra_head %}

{% block main_attr %}class="aside"{% endblock main_attr %}

{% block aside_left %}
<aside class="navbar navbar__dark navbar__vertical">
    <div class="burger">
        <div class="line1"></div>
        <div class="line2"></div>
        <div class="line3"></div>
    </div>
    <ul class="navbar-links sticky-box">
        {% for tutorial in course_tutorials %}
            {% if object == tutorial %}
                <li class="navbar-item"><a class="active" href="{{ tutorial.get_absolute_url }}" title="{{ tutorial.title|truncatechars:50 }}">{{ forloop.counter }} - {{ tutorial.title }} </a></li>
            {% else %}
                <li class="navbar-item"><a href="{{ tutorial.get_absolute_url }}" title="{{ tutorial.title|truncatechars:50 }}">{{ forloop.counter }} - {{ tutorial.title }} </a></li>
            {% endif %}
        {% endfor %}
    </ul>
</aside>
{% endblock aside_left %}

{% block main %}
<h1 class="large">{{ object.title }}</h1>
{% if request.user.is_staff or object.author == request.user %}
    <div class="my-2 d-flex space-between">
        <a href="modify_tutorial.html" class="btn btn__info btn__large">Modifier le tutoriel</a>
        <a href="#" class="btn btn__danger btn__large">Supprimer le tutoriel</a>
    </div>
{% endif %}
<div class="center-text">
    <i class="far fa-eye"></i>&nbsp;{{ object.views }}&nbsp;|&nbsp;<a data-href="{{ object.get_favorite_api_url }}" href="{{ object.get_favorite_url }}" class="favorite-span"><i class="{% if tutorial_in_favorite %}fas{% else %}far{% endif %} fa-star favorite"></i></a>
</div>
<div>
    {{ object.content|safe }}
</div>
{% if prev_tutorial or next_tutorial %}
    <div class="d-flex space-between">
        {% if prev_tutorial %}
            <a href="{{ prev_tutorial.get_absolute_url }}" title="{{ prev_tutorial.title }}" class="btn btn__outline__success btn__large">Précédent</a>
        {% endif %}
        {% if next_tutorial %}
            {% if prev_tutorial is None %}
                <span></span>
            {% endif %}
            <a href="{{ next_tutorial.get_absolute_url }}" title="{{ next_tutorial.title }}" class="btn btn__outline__success btn__large">Suivant</a>
        {% endif %}
    </div>
{% endif %}
{% endblock main %}

{% block comments %}
<div class="comments py-2">
    {% include 'courses/tutorial_comments.html' %}
</div>
{% endblock comments %}

{% block javascript %}
<script src="{% static 'js/highlight.pack.js' %}"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="{% static 'js/typed.min.js' %}"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
{% endblock javascript %}

{% block jquery %}$('.reply').hide();$('.reply-btn').click(function () {$(this).parent().next().toggle();});
function ajaxComments(){
    $('.form.comment-form, .form.reply-form').submit(function(e){
        e.preventDefault();
        $.ajax({
            method: $(this).attr('method'),
            url: $(this).attr('action'),
            data: $(this).serialize(),
            dataType: 'json',
            success: function(response){
                $('.comments').html(response.html);
                $('textarea').val('');
                $('.reply').hide();$('.reply-btn').click(function () {$(this).parent().next().toggle();});
                ajaxComments();
            },
            error: function(rs, e){
                console.log(rs.responseText);
            },
        });
    });
}
ajaxComments();
$('.favorite-span').hover(function(e){
    $(this).css('cursor', 'pointer');
});
function favori(ele) {
    if (ele.hasClass('fas')) {
        ele.attr('title', "Enlever des favoris");
    } else {
        ele.attr('title', "Mettre en favoris");
    }
};
$('.favorite-span').click(function(e){
    e.preventDefault();
    $.ajax({
        url: $(this).attr('href'),
        method: "GET",
        data: {
            favorite: 'ok'
        },
        success: function(data){
            $('.fa-star.favorite').toggleClass('far fas');
            favori($('.fa-star.favorite'));
        },
        error: function(error){
            console.log(error);
        }
    });
});
{% endblock jquery %}
